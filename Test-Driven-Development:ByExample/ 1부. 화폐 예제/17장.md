### 17장. Money 회고
#### 순서
1. 다음에 할일은 무엇인가
2. 메타포 - 설계 구조에 미치는 메타포의 엄청난 영향
3. JUnit 사용도 - 언제 테스트를 실행했으며, JUnit을 어떻게 사용해 왔는가.
4. 코드 메트릭스(metrics) - 결과 코드의 수치화
5. 프로세스 - 빨강/초록/리팩토링 순서와 각 단계에서 얼마 만큼 작업해야 하는가
6. 테스트의 질 - 전통적인 테스트 메트릭스에 TDD 테스트가 어떻게 필적할 수 있는가

### 다음에 할 일은 무엇인가
- Money 예제에서 지저분한 중복이 Sum.plus()와 Money.plus() 사이에 남아있다. 
- Expression을 인터페이스 대신 클래스로 바꾼다면 공통되는 코드를 적절히 담아낼 것이다. 
- TDD를 완벽을 위한 노력의 일환으로 사용할 수 있겠지만 그건 TDD의 가장 효과적인 용법이 아니다. 
- 작업을 끝낸 후에 코드 감정(code critic) 프로그램을 실행하자.
- "다음에 할 일은 무엇인가"에 관련된 또 다른 질문은 "어떤 테스트들이 추가로 더 필요할까?"다. 
  - 성공하는 테스트가 실패하는 경우에는 그 이유를 찾아내야한다. 
  - 실패해야하는 테스트가 실제로 실패한다면 이미 알려진 제한사항 또는 앞으로 해야할 작업 등의 의미로 그 사실을 기록해둘 수 있다. 
- 할일 목록이 빌때가 그때까지 설계한 것을 검토하기에 적절한 시기다. 

### 메타포
- Expression(수식) 메타포를 생각했는데 설계가 기존과는 완전히 다른 방향으로 흘렀다. 
- 메타포라는 건 단지 이름들을 얻어 내는 데 필요한 것일 뿐이지 않은가? 절대 그렇지 않다. 
  - MoneySum -> MoneyBag -> Wallet
- Expression 메타포는 중복되는 통화를 합치는 세세한 일단의 문제에서 해방 시켰다. 
- 코드도 더 명확해져갔다. 
- 메타포에 따라서 설계 방향이 달라질 수도 있다. 

### JUnit 사용도
- 보통 일분에 한 번 정도 테스트를 실행했다.
- 성공 혹은 실패를 보고 놀랐는데 그것은 조급하게 리팩토링을 한 경우였다. 

### 코드 메트릭스
- 코드와 테스트 사이에 대략 비슷한 양의 함수와 줄이 있는 것을 알 수 있다. 
- 모델 코드와 테스트 코드 사이의 대략적인 줄 수의 비율은 비슷하게 유지될 것이다.
- 테스트 코드에 분기나 반복문이 전혀 없기 때문에 테스트 복잡도는 1이다.
- 명시적인 흐름 제어 대신 다형성을 주로 사용했기 때문에 실제 코드의 복잡도 역시 낮다. 

### 프로세스
- TDD의 주기
1. 작은 테스트를 추가한다. 
2. 모든 테스트를 실행하고 실패하는 것을 확인한다. 
3. 코드에 변화를 준다. 
4. 모든 테스트를 실행하고, 성공하는 것을 확인한다. 
5. 중복을 제거하기 위해 리팩토링한다. 

### 테스트의 질
- TDD의 부산물로 자연히 생기는 테스트들은 시스템의 수명이 다할 때까지 함께 유지돼야 할 만큼 확실히 유용하다
- 하지만 이 테스트들이 다음과 같은 다른 종류의 테스트들을 대체할 수 있을 거라고 예상해서는 안된다.
  - 성능 테스트
  - 스트레스 테스트
  - 사용성 테스트
- 테스트의 역할은 감시라기 보다는 의사소통의 증폭기에 좀더 가까운 무언가로 바뀌게 될 것이다.
  - 이 시스템이 무엇을 해야하는지 일반적으로 어떤 느낌만 가지고 있는 사람들과 시스템이 실제로 그 일을 하도록 만들 사람들 간의 의사소통이다. 
- 테스트에 대해 널리 사용되는 지표
1. 명령문 커버리지(statement coverage)
   - 테스트의 질에 대한 충분한 평가 기준이 될 순 없지만 테스트의 시작점이다. 
   - TDD는 100% 명령문 커버리지를 종교적으로 따른다. 
   - 전체 커버리지 수치는 프로그램의 서로 다른 경우를 테스트하는 테스트 수를 테스팅이 필요한 경우의 수(로직의 복잡도)로 나눈것이다. 
2. 결함 삽입(defect insertion)
   - 코드의 의미를 바꾼 후에 테스트가 실패하는지 보는 것이다. 

- 테스트 커버리지를 향상시키는 방법
  - 더 많은 테스트를 작성하는 것
  - 테스트의 수는 그대로 두면서 프로그램의 로직을 단순화하는 것
  - 우리는 테스트는 그래돌 두고 코드를 줄여서 동일한 테스트가 다양한 경우를 다루게 한다. 

### 최종 검토
TDD를 가르칠때 사람들이 자주 놀라는 세 가지는 
- 테스트를 확실히 돌아가게 만드는 세가지 접근법 
  - 가짜로 구현하기
  - 삼각측량법
  - 명백하게 구현하기
- 설계를 주도하기 위한 방법으로 테스트 코드와 실제 코드 사이의 중복을 제거하기
- 길이 미끄러우면 속도를 줄이고 상황이 좋으면 속돌를 높이는 식으로 테슽 사이의 간격을 조절할 수 있는 능력
